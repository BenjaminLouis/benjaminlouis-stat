---
title: "Mes astuces préférées pour travailler avec ggplot dans un document RMarkdown"
author: "Benjamin Louis"
date: '2020-05-21'
slug: fr
categories:
  - configuration
  - astuces
tags:
  - R
  - rmarkdown
  - ggplot2
---

Écrire un document R Markdown (#ref) permet d'insérer du code R et les résultats directement dans un rapport dont on choisira le format de sortie (HTML, PDF, ...). C'est un atout précieux dans la reproductibilité des analyses et dans la communication de méthodes et résultats d'analyse. En tant que personne dont le métier est d'analyser quotidiennement des données pour des clients et de livrer fréquemment les résultats sous forme de rapport, R Markdown est devenu un outil essentiel de mon quotidien.

Une analyse de données passe forcément par l'utilisation de graphique. Il existe tout un panel de packages dans R pour construire des graphiques mais `ggplot2` (#ref) reste mon préféré (et je sais ne pas être seul). J'intégre donc fréquemment des graphiques faits avec `ggplot2` dans mes documents R Markdown.

R markdown et `ggplot2` ont selon moi un avantage commun essentiel : leurs rendus sont hautement personnalisables ! Cet avantage tourne vite à l'inconvénient lorsque l'on débute : il existe tellement d'options qu'il est parfois fastidieux de savoir lesquelles utilisées et comment les combiner. Les configurations qui m'ont demandé le plus de temps sont celles concernant la taille des graphiques et la taille relative des éléments des graphques (textes, légendes, ...). Dans cet article, je vous partage quelques astuces qui me permettent d'arriver à mes objectifs et ceux de mes clients.

__Pré-requis__

1. Dans cette article je pars du principe que vous avez déjà créer un graphique avec `ggplot2` et que vous avez essayer de le personnaliser. Si ça n'est pas le cas, vous pouvez commencer par consulter [ce livre](https://ggplot2-book.org/) disponible gratuitement en ligne. Ici on partira du graphique suivant :

```{r}
library(ggplot2)
p <- ggplot(iris, aes(x = Sepal.Length, y = Petal.Length, color = Species)) +
  geom_point() +
  geom_smooth(method = "lm", formula = "y ~ x")
p
```

2. De même, vous êtes familier avec les documents R Markdown et vous savez ce qu'est un _chunk_. Dans le cas contraire, commencez [ici](https://bookdown.org/yihui/rmarkdown/)

# Créer son propre thème `ggplot2`

Le thème `ggplot2` correspond à l'apparence du graphique. Il est possible de changer des éléments un par un via la fonction [`theme()`](https://ggplot2.tidyverse.org/reference/theme.html) mais il existe des thèmes pré-configurés. Par défaut c'est `theme_gray()` qui est utilisé. Personnellement j'utilise plus souvent `theme_bw()` (pour black and white).


```{r out.width = "50%", fig.show='hold'}
p + labs(title = "Thème par défaut")
p + theme_bw() + labs(title = "Avec theme_bw()")
```   

Si vous appliquez souvent les mêmes changements via la fonction `theme()`, je vous recommande fortement de créer votre propre thème. Et un thème c'est avant tout une fonction. Voici ce que j'utilise souvent pour mon propre thème :

```{r}
theme_ben <- function(base_size = 14, base_family = "Palatino") {
  theme_bw(base_size = base_size, base_family = base_family) %+replace%
    theme(
      plot.title = element_text(size = rel(1), face = "bold"),
      axis.title = element_text(size = rel(0.85), face = "bold"),
      axis.text = element_text(size = rel(0.70), face = "bold")
    )
}
```

```{r}
p + theme_ben() + labs(title = "Avec mon thème personnalisé")
```


Goal

Making your theme

Size and size ratio of R generated figure

size of figure in the document

Don't repeat yourself

